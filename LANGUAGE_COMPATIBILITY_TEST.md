# 🌍 离线翻译语言兼容性测试

## 📊 支持的语言列表（59种语言）

根据 `utils/mlKitLanguageMapper.ts` 中的 `OFFLINE_SUPPORTED_LANGUAGES`：

### ✅ 已测试成功（4种）
- ✅ **zh** (中文) - 已迁移并测试通过
- ✅ **ja** (日语) - 测试通过
- ✅ **ko** (韩语) - 测试通过  
- ✅ **en** (英语) - 测试通过

**所有 12 个翻译方向都成功！**

---

## 🔧 语言码映射分析

### 需要映射的语言（6种）

| 应用语言码 | ML Kit 码 | 状态 | 说明 |
|-----------|----------|------|------|
| `zh-CN` | `zh` | ✅ 已修复 | 中文简体 → 统一为 zh |
| `zh-TW` | `zh` | ✅ 已修复 | 中文繁体 → 统一为 zh |
| `en-US` | `en` | ✅ 应该正常 | 美式英语 → en |
| `en-GB` | `en` | ✅ 应该正常 | 英式英语 → en |
| `pt-BR` | `pt` | ✅ 应该正常 | 巴西葡萄牙语 → pt |
| `pt-PT` | `pt` | ✅ 应该正常 | 葡萄牙葡萄牙语 → pt |
| `es-ES` | `es` | ✅ 应该正常 | 西班牙语（西班牙）→ es |
| `es-MX` | `es` | ✅ 应该正常 | 西班牙语（墨西哥）→ es |

### 不需要映射的语言（53种）

这些语言码本身就是 ML Kit 格式，应该都能**直接正常工作**：

#### 亚洲语言（19种）
- `hi` (印地语), `th` (泰语), `vi` (越南语), `id` (印尼语)
- `ms` (马来语), `tl` (菲律宾语), `bn` (孟加拉语), `ur` (乌尔都语)
- `ta` (泰米尔语), `te` (泰卢固语), `gu` (古吉拉特语), `kn` (卡纳达语)
- `ml` (马拉雅拉姆语), `pa` (旁遮普语), `or` (奥里亚语), `as` (阿萨姆语)
- `my` (缅甸语), `km` (高棉语), `lo` (老挝语), `si` (僧伽罗语)
- `ne` (尼泊尔语), `bo` (藏语), `mn` (蒙古语), `ka` (格鲁吉亚语)
- `hy` (亚美尼亚语), `az` (阿塞拜疆语), `kk` (哈萨克语), `ky` (吉尔吉斯语)
- `uz` (乌兹别克语), `tg` (塔吉克语), `ps` (普什图语), `sd` (信德语)
- `ug` (维吾尔语)

#### 欧洲语言（28种）
- `es` (西班牙语), `fr` (法语), `de` (德语), `ru` (俄语)
- `pt` (葡萄牙语), `it` (意大利语), `nl` (荷兰语), `pl` (波兰语)
- `sv` (瑞典语), `no` (挪威语), `da` (丹麦语), `fi` (芬兰语)
- `cs` (捷克语), `hu` (匈牙利语), `ro` (罗马尼亚语), `bg` (保加利亚语)
- `hr` (克罗地亚语), `sk` (斯洛伐克语), `sl` (斯洛文尼亚语), `lt` (立陶宛语)
- `lv` (拉脱维亚语), `et` (爱沙尼亚语), `el` (希腊语), `tr` (土耳其语)
- `uk` (乌克兰语), `be` (白俄罗斯语), `mk` (马其顿语), `sr` (塞尔维亚语)
- `bs` (波斯尼亚语), `sq` (阿尔巴尼亚语), `mt` (马耳他语), `is` (冰岛语)
- `ga` (爱尔兰语), `cy` (威尔士语), `eu` (巴斯克语), `ca` (加泰罗尼亚语)
- `gl` (加利西亚语)

#### 中东和非洲语言（6种）
- `ar` (阿拉伯语), `fa` (波斯语), `he` (希伯来语), `am` (阿姆哈拉语)
- `ha` (豪萨语), `sw` (斯瓦希里语), `yo` (约鲁巴语), `ig` (伊博语)
- `xh` (科萨语), `zu` (祖鲁语), `af` (南非荷兰语)

---

## 🧪 推荐测试策略

### 阶段 1: 验证常用欧洲语言（优先）⭐

选择 5-6 种最常用的语言测试：

```
测试语言包：
1. fr (法语) - 20MB
2. de (德语) - 23MB  
3. es (西班牙语) - 22MB
4. pt (葡萄牙语) - 22MB
5. it (意大利语) - 23MB
6. ru (俄语) - 29MB
```

**测试用例：**
```
en → fr: Hello → Bonjour
fr → en: Bonjour → Hello
en → de: Hello → Hallo
de → zh: Hallo → 你好
```

### 阶段 2: 验证亚洲语言（重点）

```
测试语言包：
1. hi (印地语) - 27MB
2. th (泰语) - 25MB
3. vi (越南语) - 24MB
4. id (印尼语) - 23MB
```

**测试用例：**
```
en → hi: Hello → नमस्ते
en → th: Hello → สวัสดี
zh → vi: 你好 → Xin chào
```

### 阶段 3: 验证中东语言

```
测试语言包：
1. ar (阿拉伯语) - 30MB
2. fa (波斯语) - 26MB
3. he (希伯来语) - 22MB
4. tr (土耳其语) - 23MB
```

**测试用例：**
```
en → ar: Hello → مرحبا
en → fa: Hello → سلام
```

---

## 🎯 快速验证脚本

### 在应用设置中批量下载语言包：

1. **恢复网络**
2. **进入设置 → 语言包管理**
3. **下载以下语言包（按优先级）：**

**第一批（常用欧洲语言）：**
- [ ] fr (法语)
- [ ] de (德语)
- [ ] es (西班牙语)
- [ ] it (意大利语)
- [ ] pt (葡萄牙语)

**第二批（亚洲语言）：**
- [ ] hi (印地语)
- [ ] th (泰语)
- [ ] vi (越南语)
- [ ] id (印尼语)

**第三批（中东语言）：**
- [ ] ar (阿拉伯语)
- [ ] tr (土耳其语)
- [ ] fa (波斯语)

### 批量测试翻译

下载完成后，开启飞行模式，测试：

```javascript
测试矩阵（每个语言测试 2-3 个方向）：

// 法语
en → fr: "Hello" → "Bonjour"
fr → en: "Bonjour" → "Hello"
zh → fr: "你好" → "Bonjour"

// 德语
en → de: "Hello" → "Hallo"  
de → zh: "Hallo" → "你好"

// 西班牙语
en → es: "Hello" → "Hola"
es → ja: "Hola" → "こんにちは"

// 意大利语
en → it: "Hello" → "Ciao"
it → ko: "Ciao" → "안녕하세요"

// 葡萄牙语
en → pt: "Hello" → "Olá"
pt → zh: "Olá" → "你好"

// 印地语
en → hi: "Hello" → "नमस्ते"
hi → zh: "नमस्ते" → "你好"

// 泰语
en → th: "Hello" → "สวัสดี"

// 越南语
en → vi: "Hello" → "Xin chào"

// 阿拉伯语
en → ar: "Hello" → "مرحبا"
ar → zh: "مرحبا" → "你好"

// 土耳其语
en → tr: "Hello" → "Merhaba"
```

---

## 📊 预期结果

### ✅ 应该全部成功的原因：

1. **映射逻辑已完善**
   - 所有需要映射的语言都在 `mapToMlKitLangCode` 中
   - 下载、检查、翻译都使用统一映射

2. **检查逻辑已兼容**
   - 同时支持旧格式和新格式
   - 自动数据迁移

3. **模型验证机制**
   - 翻译前验证模型文件存在
   - 双重验证保证可靠性

4. **大多数语言不需要映射**
   - 直接就是 ML Kit 格式
   - 无需特殊处理

---

## 🔍 如何验证

### 下载时的日志模式：

**不需要映射的语言（如 fr, de）：**
```
🔄 下载语言包: fr → ML Kit: fr
✅ fr 语言包真正下载完成（存储为 fr）
```

**需要映射的语言（如 pt-BR）：**
```
🔄 下载语言包: pt-BR → ML Kit: pt
✅ pt-BR 语言包真正下载完成（存储为 pt）
```

### 翻译时的日志模式：

```
LOG  📱 离线翻译: "Hello" (en/en → fr/fr)
LOG  🔍 离线翻译检查: en(en) → fr(fr) (已下载)
LOG  ✅ 模型已验证: en → fr
LOG  ✅ ML Kit 翻译成功: Bonjour
```

---

## 📝 测试报告模板

```
### 测试日期: ___________

#### 已下载语言包：
- [x] zh, ja, ko, en (已验证)
- [ ] fr (法语)
- [ ] de (德语)
- [ ] es (西班牙语)
- [ ] pt (葡萄牙语)
- [ ] it (意大利语)
- [ ] ar (阿拉伯语)
- [ ] ...

#### 测试结果：
| 语言对 | 输入 | 输出 | 状态 | 备注 |
|--------|------|------|------|------|
| en → fr | Hello | Bonjour | ✅ | - |
| fr → en | Bonjour | Hello | ✅ | - |
| en → de | Hello | Hallo | ✅ | - |
| de → zh | Hallo | 你好 | ✅ | - |
| ... | ... | ... | ... | ... |

#### 发现的问题：
1. _____________
2. _____________

#### 结论：
_____________
```

---

## 🚀 开始测试

### 推荐顺序：

1. **下载 1-2 种欧洲语言**（如 fr, de）
   - 验证下载过程
   - 测试离线翻译
   - 确认日志正确

2. **如果成功，继续下载其他语言**
   - 批量下载 5-10 种
   - 批量测试

3. **最后测试特殊语言**
   - 阿拉伯语（RTL 文字）
   - 泰语（复杂字符）
   - 印地语（Devanagari 文字）

---

## 💡 提示

### 存储空间预估：
- 已下载：zh (25MB) + ja (28MB) + ko (26MB) + en (20MB) = **99 MB**
- 如果再下载 10 种语言：约 **250 MB**
- 下载所有 59 种：约 **1.5 GB**

### 建议：
- 先测试 5-10 种最常用的语言
- 验证机制正常后，可以批量下载
- 定期清理不常用的语言包

---

**准备好开始测试了吗？** 

建议步骤：
1. 关闭飞行模式（恢复网络）
2. 进入语言包管理
3. 下载法语 (fr)
4. 下载完成后开启飞行模式
5. 测试 `en → fr`: Hello → Bonjour

告诉我结果！🚀

